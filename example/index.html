<!DOCTYPE html>
<html>
  <head>
    <title>GrinderyWalletSDK Example</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="my-2">
    <h1 class="text-3xl font-bold text-center px-4">
      GrinderyWalletSDK usage example
    </h1>
    <div id="walletSDK" class="px-4 py-4 text-center">
      Waiting wallet provider...
    </div>
    <script type="text/javascript">
      // inject tg user id for testing
      // optional, comment this script if not needed
      window.Telegram = {
        WebApp: {
          initDataUnsafe: {
            user: {
              //id: '66670057',
            },
          },
        },
      };
    </script>
    <script
      src="dist/grindery-wallet-sdk.umd.development.js"
      type="text/javascript"
    ></script>
    <script type="text/javascript">
      addEventListener('load', () => {
        const provider =
          window.Grindery &&
          window.Grindery.WalletSDK &&
          window.Grindery.WalletSDK.provider;

        if (provider) {
          provider.on('connect', () => {
            const el = document.getElementById('walletSDK');
            if (el) {
              el.innerHTML =
                '<button class="py-2 px-4 bg-blue-500 text-white rounded-xl connect">Connect Grindery Wallet</button>';
              const button = el.querySelector('button');
              if (button) {
                button.addEventListener('click', () => {
                  button.innerHTML = 'Connecting...';
                  button.disabled = true;

                  provider
                    .request({ method: 'eth_requestAccounts' })
                    .then(accounts => {
                      console.log('eth_requestAccounts', accounts);
                      el.innerHTML = '<p>Grindery Wallet Connected!</p>';
                    })
                    .catch(error => {
                      console.error('eth_requestAccounts', error);
                      button.innerHTML = 'Try again';
                      button.disabled = false;
                    });
                });
              }
            }

            provider.on('pairing', data => {
              if (
                window.Telegram &&
                window.Telegram.WebApp &&
                window.Telegram.WebApp.openLink
              ) {
                window.Telegram.WebApp.openLink(data.connectUrlBrowser);
              } else {
                window.open(data.connectUrl, '_self');
              }
            });

            provider.on('disconnect', data => {
              console.log('disconnect', data);
            });
          });
        }
      });
    </script>
  </body>
</html>
